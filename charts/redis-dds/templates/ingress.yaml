{{ if .Values.enableAvi }}
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: "{{ include "redis-dds.fullname" . }}-ingress"
  labels:
    {{- include "redis-dds.labels" . | nindent 4 }}
  annotations:
    avi_proxy: '{
        "virtualservice":{
          "fqdn": "{{ .Release.Name }}.{{ .Values.ingress.domain }}",
          "services":[{"port": {{ .Values.redis.service.port }}},{"port": {{ .Values.prometheus.service.port }}}],
          "application_profile_ref": "/api/applicationprofile?name=System-L4-Application",
          "network_profile_ref": "/api/networkprofile?name=System-TCP-Proxy",
          "http_policies": []
        }
    }'
spec:
  backend:
    serviceName: {{ include "redis-dds.fullname" . }}
    servicePort: 6379
{{- end }}
